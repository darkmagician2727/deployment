<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Ranking</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
        }

        .song {
            margin-bottom: 10px;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        button {
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Song Ranking</h2>
    <div id="songContainer"></div>
    <div class="button-container">
        <button onclick="rankAlbums()">Rank Albums</button>
        <button onclick="startTournament()">Start Song Tournament</button>
        <button onclick="viewRanking()">View Final Ranking</button>
    </div>
</div>

<script>
    const albums = Array.from({ length: 10 }, (_, index) => ({ id: index + 1, name: `Album ${index + 1}` }));
    const songs = Array.from({ length: 300 }, (_, index) => ({ id: index + 1, name: `Song ${index + 1}`, albumId: Math.ceil((index + 1) / 30) }));
    const albumRankingsKey = 'albumRankings';
    const songRankingsKey = 'songRankings';

    function initializeAlbumRankings() {
        const albumRankings = {};
        albums.forEach(album => {
            albumRankings[album.id] = 0;
        });
        localStorage.setItem(albumRankingsKey, JSON.stringify(albumRankings));
    }

    function rankAlbums() {
        initializeAlbumRankings();
        const albumRankings = JSON.parse(localStorage.getItem(albumRankingsKey));
        albums.forEach(album => {
            const userInput = prompt(`Rank ${album.name} (1-${albums.length}):`);
            albumRankings[album.id] = parseInt(userInput);
        });
        localStorage.setItem(albumRankingsKey, JSON.stringify(albumRankings));
        alert('Album ranking completed.');
    }

    function initializeSongRankings() {
        const songRankings = {};
        songs.forEach(song => {
            songRankings[song.id] = { mmr: 1000 }; // Initial MMR
        });
        localStorage.setItem(songRankingsKey, JSON.stringify(songRankings));
    }

    function generatePairings() {
        const pairings = [];
        for (let i = 0; i < songs.length; i++) {
            for (let j = i + 1; j < songs.length; j++) {
                pairings.push({ song1: songs[i], song2: songs[j] });
            }
        }
        return pairings;
    }

    function getUserPreference(pairing) {
        const userInput = prompt(`Rank these songs from best to worst:\n1. ${pairing.song1.name}\n2. ${pairing.song2.name}`);
        const preferences = userInput.split(',').map(pref => parseInt(pref.trim()));
        return preferences;
    }

    function updateRankings(pairings, preferences) {
        const songRankings = JSON.parse(localStorage.getItem(songRankingsKey));
        pairings.forEach((pairing, index) => {
            const preference = preferences[index];
            const expectedOutcome = 1 / (1 + 10 ** ((songRankings[pairing.song2.id].mmr - songRankings[pairing.song1.id].mmr) / 400));
            const outcome = preference[0] < preference[1] ? 1 : 0;
            const k = 32; // Adjustment factor

            songRankings[pairing.song1.id].mmr += k * (outcome - expectedOutcome);
            songRankings[pairing.song2.id].mmr += k * ((1 - outcome) - (1 - expectedOutcome));
        });
        localStorage.setItem(songRankingsKey, JSON.stringify(songRankings));
    }

    function startTournament() {
        initializeSongRankings();
        const pairings = generatePairings();
        const preferences = pairings.map(pairing => getUserPreference(pairing));
        updateRankings(pairings, preferences);
        alert('Song tournament completed. Rankings updated.');
    }

    function viewRanking() {
        const songRankings = JSON.parse(localStorage.getItem(songRankingsKey));
        const sortedRankings = Object.entries(songRankings).sort((a, b) => b[1].mmr - a[1].mmr);
        
        const songContainer = document.getElementById('songContainer');
        songContainer.innerHTML = '<h3>Final Song Ranking</h3>';

        sortedRankings.forEach((entry, index) => {
            const [songId, { mmr }] = entry;
            const song = songs.find(s => s.id === parseInt(songId));
            const rank = index + 1;
            const songDiv = document.createElement('div');
            songDiv.classList.add('song');
            songDiv.textContent = `${rank}. ${song.name} (Album ${song.albumId}) - MMR: ${mmr.toFixed(2)}`;
            songContainer.appendChild(songDiv);
        });
    }
</script>

</body>
</html>

